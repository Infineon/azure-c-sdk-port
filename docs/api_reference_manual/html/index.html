<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Azure C SDK Port Library: Overview</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen_style.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><a href="http://www.cypress.com/"><img alt="Logo" src="cypress_logo.png"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Azure C SDK Port Library</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('index.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Overview </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p >This library implements the port layer for the <a href="https://github.com/Azure/azure-sdk-for-c/releases/tag/1.1.0">Azure SDK for Embedded C</a> to work on PSoC&trade; 6 MCU connectivity-enabled platforms. This library automatically pulls the Azure SDK for Embedded C library; the port layer functions implemented by this library are used by the <a href="https://github.com/Azure/azure-sdk-for-c/releases/tag/1.1.0">Azure SDK for Embedded C</a> library.</p>
<h1><a class="anchor" id="section_features"></a>
Features</h1>
<ul>
<li>Supports RESTful HTTP methods: HEAD, GET, PUT, POST, DELETE and PATCH.</li>
<li>See <a href="https://github.com/Azure/azure-sdk-for-c/blob/master/sdk/docs/iot/README.md">Azure SDK features</a> for the list of IoT features supported.</li>
<li>This library also includes sample applications which demonstarte Azure IoT hub, and Azure DPS usecase using <a href="https://github.com/Infineon/mqtt/releases/tag/release-v3.1.0">MQTT Library</a> and <a href="https://github.com/Azure/azure-sdk-for-c/releases/tag/1.1.0">Microsoft Azure SDK for Embedded C Library</a>.</li>
</ul>
<h1><a class="anchor" id="section_API_Flow_For_HTTP_Request"></a>
API Flow for HTTP Request</h1>
<p >The Azure C SDK library provides various C APIs to connect with Azure Cloud and use the services offered. The Azure C SDK library also provide APIs to form and send an HTTP request to the server. This section provides the API call sequence to issue a secure or non-secure HTTP request to the server.</p>
<h2><a class="anchor" id="section_HTTP_Client_Send_Request"></a>
HTTP Client send request</h2>
<pre class="fragment">          +-----------------------+
          | cy_http_client_init() |
          +-----------------------+
                     |
                     v
        +----------------------------+
        |    cy_http_client_create() |
        +----------------------------+
                     |
                     v
         +--------------------------+
         | cy_http_client_connect() |
         +--------------------------+
                     |
                     v
          +------------------------+
          | az_http_response_init()|
          +------------------------+
                     |
                     v
       +-------------------------------+
       | az_http_client_send_request() |
       +-------------------------------+
                     |
                     v
        +-----------------------------+
        | cy_http_client_disconnect() |
        +-----------------------------+
                     |
                     v
          +-------------------------+
          | cy_http_client_delete() |
          +-------------------------+
                     |
                     v
          +-------------------------+
          | cy_http_client_deinit() |
          +-------------------------+
</pre> <h1><a class="anchor" id="section_platform"></a>
Supported Platform</h1>
<ul>
<li><a href="https://www.infineon.com/cms/en/product/evaluation-boards/cy8cproto-062-4343w">PSoC&trade; 6 WiFi-BT Prototyping Kit (CY8CPROTO-062-4343W)</a></li>
<li><a href="https://www.infineon.com/cms/en/product/evaluation-boards/cy8ckit-062s2-43012">PSoC&trade; 62S2 Wi-Fi BT Pioneer Kit (CY8CKIT-062S2-43012)</a></li>
<li><a href="https://www.infineon.com/cms/en/product/evaluation-boards/cy8ceval-062s2/">PSoC&trade; 62S2 evaluation kit (CY8CEVAL-062S2-LAI-4373M2)</a></li>
<li><a href="https://www.infineon.com/cms/en/product/evaluation-boards/cy8ceval-062s2/">PSoC&trade; 62S2 evaluation kit (CY8CEVAL-062S2-MUR-43439M2)</a></li>
<li><a href="https://www.infineon.com/cms/en/product/evaluation-boards/kit_xmc72_evk/">XMC7200D-E272K8384 kit (KIT-XMC72-EVK)</a></li>
<li><a href="https://www.infineon.com/cms/en/product/evaluation-boards/kit_xmc72_evk/">XMC7200D-E272K8384 kit (KIT_XMC72_EVK_MUR_43439M2)</a></li>
<li><a href="https://www.infineon.com/cms/en/product/evaluation-boards/cy8ceval-062s2/">PSoC&trade; 62S2 evaluation kit (CY8CEVAL-062S2-CYW43022CUB)</a></li>
<li><a href="https://www.infineon.com/cms/en/product/evaluation-boards/cy8ceval-062s2/">PSoC&trade; 62S2 evaluation kit (CY8CEVAL-062S2-CYW955513SDM2WLIPA)</a></li>
</ul>
<h1><a class="anchor" id="section_frameworks"></a>
Supported Frameworks</h1>
<p >This middleware library is supported on the ModusToolbox&trade; environment:</p><ul>
<li>This environment uses the <a href="https://github.com/Infineon/abstraction-rtos">abstraction-rtos</a> library for RTOS abstraction APIs, the <a href="https://github.com/Infineon/http-client/releases/tag/release-v1.0.0">http-client</a> library for sending HTTP client requests and receiving server responses, and the <a href="https://github.com/Infineon/mqtt/releases/tag/release-v3.1.0">mqtt</a> library for Azure-supported IoT hub services.</li>
</ul>
<h1><a class="anchor" id="section_dependencies"></a>
Dependencies</h1>
<p >Azure C SDK Port library depends on the following libraries:</p><ul>
<li><a href="https://github.com/Azure/azure-sdk-for-c/releases/tag/1.1.0">Microsoft Azure SDK for Embedded C</a></li>
<li><a href="https://github.com/Infineon/wifi-mw-core">Wi-Fi Middleware Core</a></li>
<li><a href="https://github.com/Infineon/mqtt/releases/tag/release-v3.1.0">MQTT</a></li>
<li><a href="https://github.com/Infineon/http-client">HTTP Client</a></li>
<li><a href="https://github.com/Infineon/aws-iot-device-sdk-port">AWS IoT SDK Port</a></li>
</ul>
<h1><a class="anchor" id="section_quick_start"></a>
Quick Start</h1>
<p >This library is supported only on the ModusToolbox&trade; environment. The following section provides steps to build the library on the ModusToolbox&trade;.</p>
<ul>
<li>Review and make the required changes to the pre-defined configuration files.<ul>
<li>The configuration files are bundled with the wifi-mw-core library for FreeRTOS, lwIP, and Mbed TLS. See <a href="https://github.com/Infineon/wifi-mw-core/blob/master/README.md">README.md</a> for more details.</li>
<li>If the application is using bundle library then the configuration files are in the bundle library. For example if the application is using <em>Wi-Fi core freertos lwip mbedtls bundle library</em>, the configuration files are in <code>wifi-core-freertos-lwip-mbedtls/configs</code> folder. Similarly if the application is using <em>Ethernet Core FreeRTOS lwIP mbedtls library</em>, the configuration files are in <code>ethernet-core-freertos-lwip-mbedtls/configs</code> folder.</li>
</ul>
</li>
<li>Define the following COMPONENTS in the application's Makefile for the HTTP client library. For additional information, see the "Quick Start" section in <a href="https://github.com/Infineon/wifi-core-freertos-lwip-mbedtls/blob/master/README.md">README.md</a>. <div class="fragment"><div class="line">COMPONENTS=FREERTOS MBEDTLS LWIP SECURE_SOCKETS</div>
</div><!-- fragment --></li>
<li>The Azure C SDK Port library disables all the debug log messages by default. To enable log messages, the application must perform the following:<ul>
<li>Add the <code>ENABLE_AZ_PORT_LOGS</code> macro to the <em>DEFINES</em> in the code example's Makefile. The Makefile entry would look as follows: <div class="fragment"><div class="line">DEFINES+=ENABLE_AZ_PORT_LOGS</div>
</div><!-- fragment --></li>
<li>Call the <code>cy_log_init()</code> function provided by the <em>cy-log</em> module. cy-log is part of the <em>connectivity-utilities</em> library. See <a href="https://Infineon.github.io/connectivity-utilities/api_reference_manual/html/group__logging__utils.html">connectivity-utilities library API documentation</a> for cy-log details.</li>
</ul>
</li>
<li>Define the following macro in the application's Makefile for HTTP client configuration:<ul>
<li>This is an optional configuration to change the HTTP response header maximum length to 'N'. By default, this value will be set to 2048: <div class="fragment"><div class="line">DEFINES+=HTTP_MAX_RESPONSE_HEADERS_SIZE_BYTES=&lt;N&gt;</div>
</div><!-- fragment --></li>
<li>To configure the user agent name in all HTTP request headers. By default, this component will be added to the request header. Update this for user-defined agent values: <div class="fragment"><div class="line">DEFINES += HTTP_USER_AGENT_VALUE=<span class="stringliteral">&quot;\&quot;anycloud-http-client\&quot;&quot;</span></div>
</div><!-- fragment --></li>
<li>Define the following macros in the application's Makefile to mandatorily disable custom configuration header files that are not needed for the build: <div class="fragment"><div class="line">DEFINES += HTTP_DO_NOT_USE_CUSTOM_CONFIG</div>
<div class="line">DEFINES += MQTT_DO_NOT_USE_CUSTOM_CONFIG</div>
</div><!-- fragment --></li>
<li>If the user application doesn't use MQTT client features, add the following path in the .cyignore file of the application to exclude the coreMQTT source files from the build: <div class="fragment"><div class="line">$(SEARCH_aws-iot-device-sdk-embedded-C)/libraries/standard/coreMQTT</div>
<div class="line">libs/aws-iot-device-sdk-embedded-C/libraries/standard/coreMQTT</div>
</div><!-- fragment --></li>
</ul>
</li>
<li>Sample applications for Azure IoT hub, and Azure DPS features are located in folder <code>./sample_app/</code>. For running the sample applications on PSoC&trade; 6 MCU connectivity-enabled platforms, Refer README.md located in *./sample_app/README.md*.</li>
</ul>
<h1><a class="anchor" id="Additional_info"></a>
Addtional Information</h1>
<ul>
<li><a href="https://github.com/Azure/azure-sdk-for-c/releases/tag/1.1.0">Microsoft Azure SDK for Embedded C Library</a>.</li>
<li><a href="https://www.infineon.com/cms/en/design-support/tools/sdk/modustoolbox-software/">ModusToolbox&trade; Software Environment, Quick Start Guide, Documentation, and Videos</a>.</li>
<li><a href="https://Infineon.github.io/connectivity-utilities/api_reference_manual/html/group__logging__utils.html">Connectivity Utilities API documentation - for cy-log details</a>.</li>
<li><a href="https://github.com/Infineon/Code-Examples-for-ModusToolbox-Software">ModusToolbox&trade; code examples</a>.</li>
</ul>
<h1><a class="anchor" id="section_code_snippet"></a>
Code Snippets</h1>
<p >This section provides code snippets for this library on the ModusToolbox&trade; environment. The code snippets given under this section uses C APIs. In general, the library features are tested on ModusToolbox&trade; using C APIs.</p>
<p >The code snippets given in this section demonstrates how Azure APIs can be used for issuing a secure and non-secure HTTP request to the server.</p>
<h2><a class="anchor" id="snip1"></a>
Code Snippet 1: Send a non-secure HTTP GET request to the server</h2>
<p >Send a HTTP GET request (header + body) to the server and receive response </p><div class="fragment"><div class="line"><span class="comment">/* HTTP Server configuration macros */</span></div>
<div class="line"><span class="preprocessor">#define MAKE_IPV4_ADDRESS(a, b, c, d)     ((((uint32_t) d) &lt;&lt; 24) | \</span></div>
<div class="line"><span class="preprocessor">                                          (((uint32_t) c) &lt;&lt; 16) | \</span></div>
<div class="line"><span class="preprocessor">                                          (((uint32_t) b) &lt;&lt; 8) |\</span></div>
<div class="line"><span class="preprocessor">                                          ((uint32_t) a))</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define SERVER_IP_ADDRESS                 MAKE_IPV4_ADDRESS(192, 168, 18, 9)</span></div>
<div class="line"><span class="preprocessor">#define SERVER_HOST                       &quot;httpbin.org&quot;</span></div>
<div class="line"><span class="preprocessor">#define SERVER_PORT                       80</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/* HTTP socket send and receive timeout */</span></div>
<div class="line"><span class="preprocessor">#define TRANSPORT_SEND_RECV_TIMEOUT_MS    ( 5000 )</span></div>
<div class="line"><span class="comment">/* URL to read the data */</span></div>
<div class="line"><span class="preprocessor">#define GET_PATH                          &quot;/get&quot;</span></div>
<div class="line"><span class="comment">/* User buffer for HTTP request and response */</span></div>
<div class="line"><span class="preprocessor">#define USER_BUFFER_LENGTH                ( 2048 )</span></div>
<div class="line"><span class="comment">/* Request body in the HTTP header */</span></div>
<div class="line"><span class="preprocessor">#define REQUEST_BODY                      &quot;Hello, world!&quot;</span></div>
<div class="line"><span class="preprocessor">#define REQUEST_BODY_LENGTH               ( sizeof( REQUEST_BODY ) - 1 )</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Application buffer to hold the HTTP request and response */</span></div>
<div class="line"><span class="keyword">static</span> uint8_t userBuffer[ USER_BUFFER_LENGTH ];</div>
<div class="line"><span class="comment">/* SSL credentials information */</span></div>
<div class="line"><span class="keyword">static</span> cy_awsport_server_info_t server_info;</div>
<div class="line"><span class="comment">/* HTTP client object used to send and recevie the requests */</span></div>
<div class="line"><span class="keyword">static</span> cy_http_client_t handle;</div>
<div class="line"><span class="comment">/* Azure SDK structure containing HTTP client request */</span></div>
<div class="line"><span class="keyword">static</span> az_http_request az_request;</div>
<div class="line"><span class="comment">/* Azure SDK structure containing HTTP client header */</span></div>
<div class="line"><span class="keyword">static</span> _az_http_request_header az_header;</div>
<div class="line"><span class="comment">/* Azure SDK structure containing HTTP server response */</span></div>
<div class="line"><span class="keyword">static</span> az_http_response az_response;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> snippet_non_secure_http_client_send(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">/* Status variables for various operations */</span></div>
<div class="line">    cy_rslt_t result = CY_RSLT_SUCCESS;</div>
<div class="line">    az_result returnStatus;</div>
<div class="line">    <span class="comment">/* User callback on disconnect */</span></div>
<div class="line">    cy_http_disconnect_callback_t http_cb;</div>
<div class="line"> </div>
<div class="line">    ( void ) memset( &amp;server_info, 0, <span class="keyword">sizeof</span>( server_info ) );</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* HTTP server information for connection */</span></div>
<div class="line">    server_info.host_name = SERVER_HOST;</div>
<div class="line">    server_info.port = SERVER_PORT;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Initialize the HTTP Client Library */</span></div>
<div class="line">    result = cy_http_client_init();</div>
<div class="line">    <span class="keywordflow">if</span>( result != CY_RSLT_SUCCESS )</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">/* Failure path */</span></div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* HTTP client disconnect callback */</span></div>
<div class="line">    http_cb = disconnect_callback;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Create an instance of the HTTP client */</span></div>
<div class="line">    result = cy_http_client_create( NULL, &amp;server_info, http_cb, NULL, &amp;handle );</div>
<div class="line">    <span class="keywordflow">if</span>( result != CY_RSLT_SUCCESS )</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">/* Failure path */</span></div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Connect the HTTP client to the server */</span></div>
<div class="line">    result = cy_http_client_connect( handle, TRANSPORT_SEND_RECV_TIMEOUT_MS, TRANSPORT_SEND_RECV_TIMEOUT_MS );</div>
<div class="line">    <span class="keywordflow">if</span>( result != CY_RSLT_SUCCESS )</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">/* Failure path */</span></div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Copy user buffer to Azure buffer structure for HTTP request handling */</span></div>
<div class="line">    az_span az_buffer = az_span_create( ( uint8_t* )userBuffer, ( int32_t )USER_BUFFER_LENGTH );</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Initialize the response structure to recevie the HTTP server response */</span></div>
<div class="line">    returnStatus = az_http_response_init( &amp;az_response, az_buffer );</div>
<div class="line">    <span class="keywordflow">if</span>( returnStatus != AZ_OK )</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">/* Failure path */</span></div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* HTTP Client handle for HTTP request send */</span></div>
<div class="line">    az_request._internal.context = handle;</div>
<div class="line">    az_request._internal.method = az_http_method_get();</div>
<div class="line">    az_request._internal.url._internal.ptr = ( uint8_t * )GET_PATH;</div>
<div class="line">    az_request._internal.url_length = strlen( GET_PATH );</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Update the header */</span></div>
<div class="line">    az_request._internal.headers_length = 1;</div>
<div class="line">    az_header.name._internal.ptr = ( uint8_t * )<span class="stringliteral">&quot;Connection&quot;</span>;</div>
<div class="line">    az_header.name._internal.size = <span class="keyword">sizeof</span>( <span class="stringliteral">&quot;Connection&quot;</span> ) - 1;</div>
<div class="line">    az_header.value._internal.ptr = ( uint8_t * )<span class="stringliteral">&quot;keep-alive&quot;</span>;</div>
<div class="line">    az_header.value._internal.size = <span class="keyword">sizeof</span>( <span class="stringliteral">&quot;keep-alive&quot;</span> ) - 1;</div>
<div class="line"> </div>
<div class="line">    az_request._internal.headers._internal.ptr = ( uint8_t * )&amp;az_header;</div>
<div class="line">    az_request._internal.headers._internal.size = <span class="keyword">sizeof</span> ( az_header ) * az_request._internal.headers_length;</div>
<div class="line"> </div>
<div class="line">    az_request._internal.body._internal.ptr = ( uint8_t * )REQUEST_BODY;</div>
<div class="line">    az_request._internal.body._internal.size = REQUEST_BODY_LENGTH;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Azure SDK api to send HTTP client request and receive HTTP response */</span></div>
<div class="line">    returnStatus = az_http_client_send_request( &amp;az_request, &amp;az_response );</div>
<div class="line">    <span class="keywordflow">if</span>( returnStatus != AZ_OK )</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">/* Failure path */</span></div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Disconnect the HTTP client from the server. */</span></div>
<div class="line">    result = cy_http_client_disconnect(handle);</div>
<div class="line">    <span class="keywordflow">if</span>( result != CY_RSLT_SUCCESS )</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">/* Failure path */</span></div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Delete the instance of the HTTP client. */</span></div>
<div class="line">    result = cy_http_client_delete(handle);</div>
<div class="line">    <span class="keywordflow">if</span>( result != CY_RSLT_SUCCESS )</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">/* Failure path */</span></div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Deinit the HTTP library. */</span></div>
<div class="line">    result = cy_http_client_deinit();</div>
<div class="line">    <span class="keywordflow">if</span>( result != CY_RSLT_SUCCESS )</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">/* Failure path */</span></div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="snip2"></a>
Code Snippet 2: Send a secure HTTP GET request to the server</h2>
<p >Send a HTTP GET request (header + body) to the server and receive the response </p><div class="fragment"><div class="line"><span class="comment">/* HTTP Server configuration macros */</span></div>
<div class="line"><span class="preprocessor">#define MAKE_IPV4_ADDRESS(a, b, c, d)     ((((uint32_t) d) &lt;&lt; 24) | \</span></div>
<div class="line"><span class="preprocessor">                                          (((uint32_t) c) &lt;&lt; 16) | \</span></div>
<div class="line"><span class="preprocessor">                                          (((uint32_t) b) &lt;&lt; 8) |\</span></div>
<div class="line"><span class="preprocessor">                                          ((uint32_t) a))</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define SERVER_IP_ADDRESS                 MAKE_IPV4_ADDRESS(192, 168, 18, 9)</span></div>
<div class="line"><span class="preprocessor">#define SERVER_HOST                       &quot;httpbin.org&quot;</span></div>
<div class="line"><span class="preprocessor">#define SERVER_PORT                       80</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/* HTTP socket send and receive timeout */</span></div>
<div class="line"><span class="preprocessor">#define TRANSPORT_SEND_RECV_TIMEOUT_MS    ( 5000 )</span></div>
<div class="line"><span class="comment">/* URL to read the data */</span></div>
<div class="line"><span class="preprocessor">#define GET_PATH                          &quot;/get&quot;</span></div>
<div class="line"><span class="comment">/* User buffer for HTTP request and response */</span></div>
<div class="line"><span class="preprocessor">#define USER_BUFFER_LENGTH                ( 2048 )</span></div>
<div class="line"><span class="comment">/* Request body in the HTTP header */</span></div>
<div class="line"><span class="preprocessor">#define REQUEST_BODY                      &quot;Hello, world!&quot;</span></div>
<div class="line"><span class="preprocessor">#define REQUEST_BODY_LENGTH               ( sizeof( REQUEST_BODY ) - 1 )</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Application buffer to hold the HTTP request and response */</span></div>
<div class="line"><span class="keyword">static</span> uint8_t userBuffer[ USER_BUFFER_LENGTH ];</div>
<div class="line"><span class="comment">/* SSL credentials information */</span></div>
<div class="line"><span class="keyword">static</span> cy_awsport_ssl_credentials_t credentials;</div>
<div class="line"><span class="comment">/* Information about the HTTP server */</span></div>
<div class="line"><span class="keyword">static</span> cy_awsport_server_info_t server_info;</div>
<div class="line"><span class="comment">/* HTTP client object used to send and recevie the requests */</span></div>
<div class="line"><span class="keyword">static</span> cy_http_client_t handle;</div>
<div class="line"><span class="comment">/* Azure SDK structure containing HTTP client request */</span></div>
<div class="line"><span class="keyword">static</span> az_http_request az_request;</div>
<div class="line"><span class="comment">/* Azure SDK structure containing HTTP client header */</span></div>
<div class="line"><span class="keyword">static</span> _az_http_request_header az_header;</div>
<div class="line"><span class="comment">/* Azure SDK structure containing HTTP client response */</span></div>
<div class="line"><span class="keyword">static</span> az_http_response az_response;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Configure the following credentials for a secure HTTP connection */</span></div>
<div class="line"><span class="comment">/* SSL server certificate */</span></div>
<div class="line"><span class="preprocessor">#define SSL_SERVERCERT_PEM      \</span></div>
<div class="line"><span class="preprocessor">&quot;-----BEGIN CERTIFICATE-----\n&quot;</span> \</div>
<div class="line">&quot;........base64 data........\n&quot; \</div>
<div class="line">&quot;-----END CERTIFICATE-----&quot;</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* SSL server private key */</span></div>
<div class="line"><span class="preprocessor">#define SSL_SERVERKEY_PEM          \</span></div>
<div class="line"><span class="preprocessor">&quot;-----BEGIN RSA PRIVATE KEY-----\n&quot;</span> \</div>
<div class="line">&quot;..........base64 data..........\n&quot; \</div>
<div class="line">&quot;-----END RSA PRIVATE KEY-----&quot;</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define SSL_ROOTCA_PEM            \</span></div>
<div class="line"><span class="preprocessor">&quot;-----BEGIN CERTIFICATE-----\n&quot;</span>   \</div>
<div class="line">&quot;........base64 data........\n&quot;   \</div>
<div class="line">&quot;-----END CERTIFICATE-----&quot;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> snippet_secure_http_client_send(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">/* Status variables for various operations */</span></div>
<div class="line">    cy_rslt_t result = CY_RSLT_SUCCESS;</div>
<div class="line">    az_result returnStatus;</div>
<div class="line">    <span class="comment">/* User callback on disconnect */</span></div>
<div class="line">    cy_http_disconnect_callback_t http_cb;</div>
<div class="line"> </div>
<div class="line">    ( void ) memset( &amp;credentials, 0, <span class="keyword">sizeof</span>( credentials ) );</div>
<div class="line">    ( void ) memset( &amp;server_info, 0, <span class="keyword">sizeof</span>( server_info ) );</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Set the credential information */</span></div>
<div class="line">    credentials.client_cert = ( <span class="keyword">const</span> <span class="keywordtype">char</span> * ) &amp;SSL_SERVERCERT_PEM;</div>
<div class="line">    credentials.client_cert_size = <span class="keyword">sizeof</span>( SSL_SERVERCERT_PEM );</div>
<div class="line">    credentials.private_key = ( <span class="keyword">const</span> <span class="keywordtype">char</span> * ) &amp;SSL_SERVERKEY_PEM;</div>
<div class="line">    credentials.private_key_size = <span class="keyword">sizeof</span>( SSL_SERVERKEY_PEM );</div>
<div class="line">    credentials.root_ca = ( <span class="keyword">const</span> <span class="keywordtype">char</span> * ) &amp;SSL_ROOTCA_PEM;</div>
<div class="line">    credentials.root_ca_size = <span class="keyword">sizeof</span>( SSL_ROOTCA_PEM );</div>
<div class="line"> </div>
<div class="line">    server_info.host_name = SERVER_HOST;</div>
<div class="line">    server_info.port = SERVER_PORT;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Initialize the HTTP client library */</span></div>
<div class="line">    result = cy_http_client_init();</div>
<div class="line">    <span class="keywordflow">if</span>( result != CY_RSLT_SUCCESS )</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">/* Failure path */</span></div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* HTTP disconnect callback */</span></div>
<div class="line">    http_cb = disconnect_callback;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Create an instance of the HTTP client */</span></div>
<div class="line">    result = cy_http_client_create( &amp;credentials, &amp;server_info, http_cb, NULL, &amp;handle );</div>
<div class="line">    <span class="keywordflow">if</span>( result != CY_RSLT_SUCCESS )</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">/* Failure path */</span></div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Connect the HTTP client to the server */</span></div>
<div class="line">    result = cy_http_client_connect( handle, TRANSPORT_SEND_RECV_TIMEOUT_MS, TRANSPORT_SEND_RECV_TIMEOUT_MS );</div>
<div class="line">    <span class="keywordflow">if</span>( result != CY_RSLT_SUCCESS )</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">/* Failure path. */</span></div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Copy user buffer to Azure buffer structure for HTTP request handling */</span></div>
<div class="line">    az_span az_buffer = az_span_create( ( uint8_t* )userBuffer, ( int32_t )USER_BUFFER_LENGTH );</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Initialize the response structure to recevie the HTTP server response */</span></div>
<div class="line">    returnStatus = az_http_response_init( &amp;az_response, az_buffer );</div>
<div class="line">    <span class="keywordflow">if</span>( returnStatus != AZ_OK )</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">/* Failure path */</span></div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* HTTP Client handle for HTTP request send */</span></div>
<div class="line">    az_request._internal.context = handle;</div>
<div class="line">    az_request._internal.method = az_http_method_get();</div>
<div class="line">    az_request._internal.url._internal.ptr = ( uint8_t * )GET_PATH;</div>
<div class="line">    az_request._internal.url_length = strlen( GET_PATH );</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Update the header */</span></div>
<div class="line">    az_request._internal.headers_length = 1;</div>
<div class="line">    az_header.name._internal.ptr = ( uint8_t * )<span class="stringliteral">&quot;Connection&quot;</span>;</div>
<div class="line">    az_header.name._internal.size = <span class="keyword">sizeof</span>( <span class="stringliteral">&quot;Connection&quot;</span> ) - 1;</div>
<div class="line">    az_header.value._internal.ptr = ( uint8_t * )<span class="stringliteral">&quot;keep-alive&quot;</span>;</div>
<div class="line">    az_header.value._internal.size = <span class="keyword">sizeof</span>( <span class="stringliteral">&quot;keep-alive&quot;</span> ) - 1;</div>
<div class="line"> </div>
<div class="line">    az_request._internal.headers._internal.ptr = ( uint8_t * )&amp;az_header;</div>
<div class="line">    az_request._internal.headers._internal.size = <span class="keyword">sizeof</span> ( az_header ) * az_request._internal.headers_length;</div>
<div class="line"> </div>
<div class="line">    az_request._internal.body._internal.ptr = ( uint8_t * )REQUEST_BODY;</div>
<div class="line">    az_request._internal.body._internal.size = REQUEST_BODY_LENGTH;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Azure SDK api to send HTTP client request and receive HTTP response */</span></div>
<div class="line">    returnStatus = az_http_client_send_request( &amp;az_request, &amp;az_response );</div>
<div class="line">    <span class="keywordflow">if</span>( returnStatus != AZ_OK )</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">/* Failure path */</span></div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Disconnect the HTTP client from the server */</span></div>
<div class="line">    result = cy_http_client_disconnect(handle);</div>
<div class="line">    <span class="keywordflow">if</span>( result != CY_RSLT_SUCCESS )</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">/* Failure path */</span></div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Delete the instance of the HTTP client */</span></div>
<div class="line">    result = cy_http_client_delete(handle);</div>
<div class="line">    <span class="keywordflow">if</span>( result != CY_RSLT_SUCCESS )</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">/* Failure path */</span></div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Deinit the HTTP library */</span></div>
<div class="line">    result = cy_http_client_deinit();</div>
<div class="line">    <span class="keywordflow">if</span>( result != CY_RSLT_SUCCESS )</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">/* Failure path */</span></div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --> </div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath">
    <ul>
        <li class="footer">
            Generated for <b>Azure C SDK Port Library</b> by <b>Cypress Semiconductor Corporation</b>.
            All rights reserved.
        </li>
    </ul>
</div>
</body>
</html>
